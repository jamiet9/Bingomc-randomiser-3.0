<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minecraft Bingo Card Randomiser</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background-color: #f0f8ff;
      overflow-x: hidden;
    }
    h1 {
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    #cardSizeDisplay {
      font-size: 18px;
      margin: 10px 0;
    }
    #bingoCard {
      margin: 0 auto;
      border-collapse: collapse;
    }
    #bingoCard td {
      border: 2px solid #333;
      width: 80px;
      height: 80px;
      vertical-align: middle;
      font-size: 12px;
      padding: 5px;
      text-align: center;
      background-color: #fff;
      transition: background-color 0.4s;
      position: relative;
    }
    #probabilityDisplay {
      margin-top: 20px;
      font-weight: bold;
      font-size: 16px;
    }
    /* Canvas for the card size spin wheel */
    #sizeWheelCanvas {
      display: none;
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 999;
      border: 2px solid #333;
      background: #fff;
    }
  </style>
</head>
<body>
  <h1>Minecraft Bingo Card Randomiser</h1>
  <button id="startButton">Generate New Card</button>
  <div id="cardSizeDisplay"></div>
  <table id="bingoCard"></table>
  <div id="probabilityDisplay"></div>

  <!-- Canvas for the spin wheel that selects card size -->
  <canvas id="sizeWheelCanvas" width="300" height="300"></canvas>
  <!-- Audio for spin and reveal sounds (replace src URLs if desired) -->
  <audio id="spinSound" src="https://www.myinstants.com/media/sounds/roulette-spin.mp3"></audio>
  <audio id="revealSound" src="https://www.myinstants.com/media/sounds/pling.mp3"></audio>

  <script>
    /***************************************
     * 1. CARD SIZE SELECTION SETTINGS
     ***************************************/
    // Revised odds for card sizes (weights). (Chance of rolling each card size will be normalized.)
    // According to your specification:
    // 5x5 most common (0.4 chance), 4x4 (0.3), 3x3 (0.25), 2x2 (0.05), 1x1 (0.005),
    // 6x6 (0.05), 7x7 (0.02), 8x8 (0.005), 9x9 (0.002), 10x10 (0.001)
    const cardSizeOdds = {
      1: 0.005,
      2: 0.05,
      3: 0.25,
      4: 0.3,
      5: 0.4,
      6: 0.05,
      7: 0.02,
      8: 0.005,
      9: 0.002,
      10: 0.001
    };
    function sumCardSizeOdds() {
      return Object.values(cardSizeOdds).reduce((a, b) => a + b, 0);
    }
  
    // Spin wheel to select card size (dramatic and slow)
    function spinForSize() {
      return new Promise((resolve) => {
        const canvas = document.getElementById("sizeWheelCanvas");
        const ctx = canvas.getContext("2d");
        canvas.style.display = "block";
  
        const totalWeight = sumCardSizeOdds();
        const sizes = Object.keys(cardSizeOdds).map(Number);
        let slices = [];
        let startAngle = 0;
        sizes.forEach(size => {
          const weight = cardSizeOdds[size];
          const angle = (weight / totalWeight) * 2 * Math.PI;
          slices.push({ size, start: startAngle, end: startAngle + angle });
          startAngle += angle;
        });
  
        // Draw the wheel with a given rotation offset
        function drawWheel(rotation) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          const cx = canvas.width / 2, cy = canvas.height / 2, r = 120;
          slices.forEach(slice => {
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, r, slice.start + rotation, slice.end + rotation);
            ctx.closePath();
            // Use a pastel color for each slice\n            ctx.fillStyle = '#' + (Math.floor(Math.random() * 127) + 127).toString(16).padStart(2, '0') + \"AAAA\";\n            // For simplicity, random pastel color\n            ctx.fillStyle = '#' + Math.floor(Math.random()*16777215).toString(16);\n            ctx.fill();\n            ctx.strokeStyle = \"#fff\";\n            ctx.stroke();\n            // Label the slice\n            const mid = (slice.start + slice.end) / 2 + rotation;\n            const tx = cx + r * 0.6 * Math.cos(mid);\n            const ty = cy + r * 0.6 * Math.sin(mid);\n            ctx.save();\n            ctx.translate(tx, ty);\n            ctx.rotate(mid);\n            ctx.fillStyle = \"#000\";\n            ctx.font = \"14px Arial\";\n            ctx.textAlign = \"center\";\n            ctx.fillText(slice.size + \"x\" + slice.size, 0, 0);\n            ctx.restore();\n          });\n          // Draw a fixed pointer at the top\n          ctx.fillStyle = \"red\";\n          ctx.beginPath();\n          ctx.moveTo(cx, cy - r - 10);\n          ctx.lineTo(cx - 10, cy - r + 10);\n          ctx.lineTo(cx + 10, cy - r + 10);\n          ctx.closePath();\n          ctx.fill();\n        }\n  
        // Dramatic spin parameters\n        let rotation = 0;\n        let angularVel = 1.0 + Math.random() * 0.5; // slower initial velocity\n        let deceleration = 0.0005; // slow deceleration for drama\n        function animate() {\n          if (angularVel > 0) {\n            rotation += angularVel;\n            angularVel -= deceleration;\n            drawWheel(rotation);\n            requestAnimationFrame(animate);\n          } else {\n            drawWheel(rotation);\n            // Determine winning slice (pointer fixed at -PI/2)\n            let pointerAngle = (-Math.PI/2 - rotation) % (2 * Math.PI);\n            if (pointerAngle < 0) pointerAngle += 2 * Math.PI;\n            let winSlice = slices.find(slice => {\n              let sa = slice.start % (2 * Math.PI);\n              let ea = slice.end % (2 * Math.PI);\n              if (sa < 0) sa += 2 * Math.PI;\n              if (ea < 0) ea += 2 * Math.PI;\n              if (sa < ea) {\n                return pointerAngle >= sa && pointerAngle < ea;\n              } else {\n                return pointerAngle >= sa || pointerAngle < ea;\n              }\n            });\n            const chosenSize = winSlice ? winSlice.size : slices[0].size;\n            setTimeout(() => {\n              canvas.style.display = \"none\";\n              resolve(chosenSize);\n            }, 500);\n          }\n        }\n        const spinSound = document.getElementById(\"spinSound\");\n        if (spinSound) { spinSound.currentTime = 0; spinSound.play(); }\n        animate();\n      });\n    }\n\n    /***************************************\n     * 2. ITEM SELECTION & RARITY\n     ***************************************/\n    // Full list of possible items\n    const fullItems = [\n      \"STONE\",\n      \"GRANITE\",\n      \"POLISHED_GRANITE\",\n      \"DIORITE\",\n      \"POLISHED_DIORITE\",\n      \"ANDESITE\",\n      \"POLISHED_ANDESITE\",\n      \"DEEPSLATE\",\n      \"COBBLED_DEEPSLATE\",\n      \"POLISHED_DEEPSLATE\",\n      \"CALCITE\",\n      \"DRIPSTONE_BLOCK\",\n      \"GRASS_BLOCK\",\n      \"DIRT\",\n      \"COARSE_DIRT\",\n      \"PODZOL\",\n      \"ROOTED_DIRT\",\n      \"MUD\",\n      \"COBBLESTONE\",\n      \"OAK_PLANKS\",\n      \"SPRUCE_PLANKS\",\n      \"BIRCH_PLANKS\",\n      \"JUNGLE_PLANKS\",\n      \"ACACIA_PLANKS\",\n      \"CHERRY_PLANKS\",\n      \"DARK_OAK_PLANKS\",\n      \"BAMBOO_PLANKS\",\n      \"BAMBOO_MOSAIC\",\n      \"OAK_SAPLING\",\n      \"SPRUCE_SAPLING\",\n      \"BIRCH_SAPLING\",\n      \"JUNGLE_SAPLING\",\n      \"ACACIA_SAPLING\",\n      \"CHERRY_SAPLING\",\n      \"DARK_OAK_SAPLING\",\n      \"MANGROVE_PROPAGULE\",\n      \"SAND\",\n      \"SUSPICIOUS_SAND\",\n      \"SUSPICIOUS_GRAVEL\",\n      \"RED_SAND\",\n      \"GRAVEL\",\n      \"COAL_ORE\",\n      \"IRON_ORE\",\n      \"COPPER_ORE\",\n      \"GOLD_ORE\",\n      \"REDSTONE_ORE\",\n      \"EMERALD_ORE\",\n      \"LAPIS_ORE\",\n      \"DIAMOND_ORE\",\n      \"ANCIENT_DEBRIS\",\n      \"COAL_BLOCK\",\n      \"RAW_IRON_BLOCK\",\n      \"RAW_COPPER_BLOCK\",\n      \"RAW_GOLD_BLOCK\",\n      \"AMETHYST_BLOCK\",\n      \"IRON_BLOCK\",\n      \"COPPER_BLOCK\",\n      \"GOLD_BLOCK\",\n      \"DIAMOND_BLOCK\",\n      \"EXPOSED_COPPER\",\n      \"WEATHERED_COPPER\",\n      \"OXIDIZED_COPPER\",\n      \"CUT_COPPER\",\n      \"EXPOSED_CUT_COPPER\",\n      \"WEATHERED_CUT_COPPER\",\n      \"OXIDIZED_CUT_COPPER\",\n      \"CUT_COPPER_STAIRS\",\n      \"EXPOSED_CUT_COPPER_STAIRS\",\n      \"WEATHERED_CUT_COPPER_STAIRS\",\n      \"OXIDIZED_CUT_COPPER_STAIRS\",\n      \"CUT_COPPER_SLAB\",\n      \"EXPOSED_CUT_COPPER_SLAB\",\n      \"WEATHERED_CUT_COPPER_SLAB\",\n      \"OXIDIZED_CUT_COPPER_SLAB\",\n      \"WAXED_COPPER_BLOCK\",\n      \"WAXED_EXPOSED_COPPER\",\n      \"WAXED_WEATHERED_COPPER\",\n      \"WAXED_OXIDIZED_COPPER\",\n      \"WAXED_CUT_COPPER\",\n      \"WAXED_EXPOSED_CUT_COPPER\",\n      \"WAXED_WEATHERED_CUT_COPPER\",\n      \"WAXED_OXIDIZED_CUT_COPPER\",\n      \"WAXED_CUT_COPPER_STAIRS\",\n      \"WAXED_EXPOSED_CUT_COPPER_STAIRS\",\n      \"WAXED_WEATHERED_CUT_COPPER_STAIRS\",\n      \"WAXED_OXIDIZED_CUT_COPPER_STAIRS\",\n      \"WAXED_CUT_COPPER_SLAB\",\n      \"WAXED_EXPOSED_CUT_COPPER_SLAB\",\n      \"WAXED_WEATHERED_CUT_COPPER_SLAB\",\n      \"WAXED_OXIDIZED_CUT_COPPER_SLAB\",\n      \"OAK_LOG\",\n      \"SPRUCE_LOG\",\n      \"BIRCH_LOG\",\n      \"JUNGLE_LOG\",\n      \"ACACIA_LOG\",\n      \"CHERRY_LOG\",\n      \"DARK_OAK_LOG\",\n      \"MANGROVE_LOG\",\n      \"MANGROVE_ROOTS\",\n      \"MUDDY_MANGROVE_ROOTS\",\n      \"BAMBOO_BLOCK\",\n      \"STRIPPED_OAK_LOG\",\n      \"STRIPPED_SPRUCE_LOG\",\n      \"STRIPPED_BIRCH_LOG\",\n      \"STRIPPED_JUNGLE_LOG\",\n      \"STRIPPED_ACACIA_LOG\",\n      \"STRIPPED_CHERRY_LOG\",\n      \"STRIPPED_DARK_OAK_LOG\",\n      \"STRIPPED_MANGROVE_LOG\",\n      \"STRIPPED_OAK_WOOD\",\n      \"STRIPPED_SPRUCE_WOOD\",\n      \"STRIPPED_BIRCH_WOOD\",\n      \"STRIPPED_JUNGLE_WOOD\",\n      \"STRIPPED_ACACIA_WOOD\",\n      \"STRIPPED_CHERRY_WOOD\",\n      \"STRIPPED_DARK_OAK_WOOD\",\n      \"STRIPPED_MANGROVE_WOOD\",\n      \"STRIPPED_BAMBOO_BLOCK\",\n      \"OAK_WOOD\",\n      \"SPRUCE_WOOD\",\n      \"BIRCH_WOOD\",\n      \"JUNGLE_WOOD\",\n      \"ACACIA_WOOD\",\n      \"CHERRY_WOOD\",\n      \"DARK_OAK_WOOD\",\n      \"MANGROVE_WOOD\",\n      \"OAK_LEAVES\",\n      \"SPRUCE_LEAVES\",\n      \"BIRCH_LEAVES\",\n      \"JUNGLE_LEAVES\",\n      \"ACACIA_LEAVES\",\n      \"CHERRY_LEAVES\",\n      \"DARK_OAK_LEAVES\",\n      \"MANGROVE_LEAVES\",\n      \"AZALEA_LEAVES\",\n      \"FLOWERING_AZALEA_LEAVES\",\n      \"SPONGE\",\n      \"WET_SPONGE\",\n      \"GLASS\",\n      \"TINTED_GLASS\",\n      \"LAPIS_BLOCK\",\n      \"SANDSTONE\",\n      \"CHISELED_SANDSTONE\",\n      \"CUT_SANDSTONE\",\n      \"COBWEB\",\n      \"SHORT_GRASS\",\n      \"FERN\",\n      \"AZALEA\",\n      \"FLOWERING_AZALEA\",\n      \"DEAD_BUSH\",\n      \"SEAGRASS\",\n      \"SEA_PICKLE\",\n      \"WHITE_WOOL\",\n      \"ORANGE_WOOL\",\n      \"MAGENTA_WOOL\",\n      \"LIGHT_BLUE_WOOL\",\n      \"YELLOW_WOOL\",\n      \"LIME_WOOL\",\n      \"PINK_WOOL\",\n      \"GRAY_WOOL\",\n      \"LIGHT_GRAY_WOOL\",\n      \"CYAN_WOOL\",\n      \"PURPLE_WOOL\",\n      \"BLUE_WOOL\",\n      \"BROWN_WOOL\",\n      \"GREEN_WOOL\",\n      \"RED_WOOL\",\n      \"BLACK_WOOL\",\n      \"DANDELION\",\n      \"POPPY\",\n      \"BLUE_ORCHID\",\n      \"ALLIUM\",\n      \"AZURE_BLUET\",\n      \"RED_TULIP\",\n      \"ORANGE_TULIP\",\n      \"WHITE_TULIP\",\n      \"PINK_TULIP\",\n      \"OXEYE_DAISY\",\n      \"CORNFLOWER\",\n      \"LILY_OF_THE_VALLEY\",\n      \"TORCHFLOWER\",\n      \"PITCHER_PLANT\",\n      \"SPORE_BLOSSOM\",\n      \"BROWN_MUSHROOM\",\n      \"RED_MUSHROOM\",\n      \"SUGAR_CANE\",\n      \"KELP\",\n      \"MOSS_CARPET\",\n      \"PINK_PETALS\",\n      \"MOSS_BLOCK\",\n      \"BIG_DRIPLEAF\",\n      \"SMALL_DRIPLEAF\",\n      \"BAMBOO\",\n      \"OAK_SLAB\",\n      \"SPRUCE_SLAB\",\n      \"BIRCH_SLAB\",\n      \"JUNGLE_SLAB\",\n      \"ACACIA_SLAB\",\n      \"CHERRY_SLAB\",\n      \"DARK_OAK_SLAB\",\n      \"MANGROVE_SLAB\",\n      \"BAMBOO_SLAB\",\n      \"BAMBOO_MOSAIC_SLAB\",\n      \"STONE_SLAB\",\n      \"SMOOTH_STONE_SLAB\",\n      \"SANDSTONE_SLAB\",\n      \"CUT_SANDSTONE_SLAB\",\n      \"PETRIFIED_OAK_SLAB\",\n      \"COBBLESTONE_SLAB\",\n      \"BRICK_SLAB\",\n      \"STONE_BRICK_SLAB\",\n      \"MUD_BRICK_SLAB\",\n      \"RED_SANDSTONE_SLAB\",\n      \"CUT_RED_SANDSTONE_SLAB\",\n      \"PRISMARINE_SLAB\",\n      \"PRISMARINE_BRICK_SLAB\",\n      \"DARK_PRISMARINE_SLAB\",\n      \"SMOOTH_RED_SANDSTONE\",\n      \"SMOOTH_SANDSTONE\",\n      \"SMOOTH_STONE\",\n      \"BRICKS\",\n      \"BOOKSHELF\",\n      \"CHISELED_BOOKSHELF\",\n      \"DECORATED_POT\",\n      \"MOSSY_COBBLESTONE\",\n      \"OBSIDIAN\",\n      \"TORCH\",\n      \"CHEST\",\n      \"CRAFTING_TABLE\",\n      \"FURNACE\",\n      \"LADDER\",\n      \"COBBLESTONE_STAIRS\",\n      \"SNOW\",\n      \"ICE\",\n      \"SNOW_BLOCK\",\n      \"CACTUS\",\n      \"CLAY\",\n      \"JUKEBOX\",\n      \"OAK_FENCE\",\n      \"SPRUCE_FENCE\",\n      \"BIRCH_FENCE\",\n      \"JUNGLE_FENCE\",\n      \"ACACIA_FENCE\",\n      \"CHERRY_FENCE\",\n      \"DARK_OAK_FENCE\",\n      \"MANGROVE_FENCE\",\n      \"BAMBOO_FENCE\",\n      \"PUMPKIN\",\n      \"CARVED_PUMPKIN\",\n      \"JACK_O_LANTERN\",\n      \"STONE_BRICKS\",\n      \"MOSSY_STONE_BRICKS\",\n      \"CRACKED_STONE_BRICKS\",\n      \"CHISELED_STONE_BRICKS\",\n      \"PACKED_MUD\",\n      \"MUD_BRICKS\",\n      \"DEEPSLATE_BRICKS\",\n      \"CRACKED_DEEPSLATE_BRICKS\",\n      \"DEEPSLATE_TILES\",\n      \"CRACKED_DEEPSLATE_TILES\",\n      \"CHISELED_DEEPSLATE\",\n      \"REINFORCED_DEEPSLATE\",\n      \"IRON_BARS\",\n      \"CHAIN\",\n      \"GLASS_PANE\",\n      \"MELON\",\n      \"VINE\",\n      \"GLOW_LICHEN\",\n      \"BRICK_STAIRS\",\n      \"STONE_BRICK_STAIRS\",\n      \"MUD_BRICK_STAIRS\",\n      \"LILY_PAD\",\n      \"ENCHANTING_TABLE\",\n      \"SANDSTONE_STAIRS\",\n      \"EMERALD_BLOCK\",\n      \"OAK_STAIRS\",\n      \"SPRUCE_STAIRS\",\n      \"BIRCH_STAIRS\",\n      \"JUNGLE_STAIRS\",\n      \"ACACIA_STAIRS\",\n      \"CHERRY_STAIRS\",\n      \"DARK_OAK_STAIRS\",\n      \"MANGROVE_STAIRS\",\n      \"BAMBOO_STAIRS\",\n      \"BAMBOO_MOSAIC_STAIRS\",\n      \"COBBLESTONE_WALL\",\n      \"MOSSY_COBBLESTONE_WALL\",\n      \"BRICK_WALL\",\n      \"PRISMARINE_WALL\",\n      \"RED_SANDSTONE_WALL\",\n      \"MOSSY_STONE_BRICK_WALL\",\n      \"GRANITE_WALL\",\n      \"STONE_BRICK_WALL\",\n      \"MUD_BRICK_WALL\",\n      \"ANDESITE_WALL\",\n      \"SANDSTONE_WALL\",\n      \"DIORITE_WALL\",\n      \"COBBLED_DEEPSLATE_WALL\",\n      \"POLISHED_DEEPSLATE_WALL\",\n      \"DEEPSLATE_BRICK_WALL\",\n      \"DEEPSLATE_TILE_WALL\",\n      \"ANVIL\",\n      \"HAY_BLOCK\",\n      \"WHITE_CARPET\",\n      \"ORANGE_CARPET\",\n      \"MAGENTA_CARPET\",\n      \"LIGHT_BLUE_CARPET\",\n      \"YELLOW_CARPET\",\n      \"LIME_CARPET\",\n      \"PINK_CARPET\",\n      \"GRAY_CARPET\",\n      \"LIGHT_GRAY_CARPET\",\n      \"CYAN_CARPET\",\n      \"PURPLE_CARPET\",\n      \"BLUE_CARPET\",\n      \"BROWN_CARPET\",\n      \"GREEN_CARPET\",\n      \"RED_CARPET\",\n      \"BLACK_CARPET\",\n      \"PACKED_ICE\",\n      \"SUNFLOWER\",\n      \"LILAC\",\n      \"ROSE_BUSH\",\n      \"PEONY\",\n      \"TALL_GRASS\",\n      \"LARGE_FERN\",\n      \"WHITE_STAINED_GLASS\",\n      \"ORANGE_STAINED_GLASS\",\n      \"MAGENTA_STAINED_GLASS\",\n      \"LIGHT_BLUE_STAINED_GLASS\",\n      \"YELLOW_STAINED_GLASS\",\n      \"LIME_STAINED_GLASS\",\n      \"PINK_STAINED_GLASS\",\n      \"GRAY_STAINED_GLASS\",\n      \"LIGHT_GRAY_STAINED_GLASS\",\n      \"CYAN_STAINED_GLASS\",\n      \"PURPLE_STAINED_GLASS\",\n      \"BLUE_STAINED_GLASS\",\n      \"BROWN_STAINED_GLASS\",\n      \"GREEN_STAINED_GLASS\",\n      \"RED_STAINED_GLASS\",\n      \"BLACK_STAINED_GLASS\",\n      \"WHITE_STAINED_GLASS_PANE\",\n      \"ORANGE_STAINED_GLASS_PANE\",\n      \"MAGENTA_STAINED_GLASS_PANE\",\n      \"LIGHT_BLUE_STAINED_GLASS_PANE\",\n      \"YELLOW_STAINED_GLASS_PANE\",\n      \"LIME_STAINED_GLASS_PANE\",\n      \"PINK_STAINED_GLASS_PANE\",\n      \"GRAY_STAINED_GLASS_PANE\",\n      \"LIGHT_GRAY_STAINED_GLASS_PANE\",\n      \"CYAN_STAINED_GLASS_PANE\",\n      \"PURPLE_STAINED_GLASS_PANE\",\n      \"BLUE_STAINED_GLASS_PANE\",\n      \"BROWN_STAINED_GLASS_PANE\",\n      \"GREEN_STAINED_GLASS_PANE\",\n      \"RED_STAINED_GLASS_PANE\",\n      \"BLACK_STAINED_GLASS_PANE\",\n      \"PRISMARINE\",\n      \"PRISMARINE_BRICKS\",\n      \"DARK_PRISMARINE\",\n      \"PRISMARINE_STAIRS\",\n      \"PRISMARINE_BRICK_STAIRS\",\n      \"DARK_PRISMARINE_STAIRS\",\n      \"SEA_LANTERN\",\n      \"RED_SANDSTONE\",\n      \"CHISELED_RED_SANDSTONE\",\n      \"CUT_RED_SANDSTONE\",\n      \"RED_SANDSTONE_STAIRS\",\n      \"MAGMA_BLOCK\",\n      \"WHITE_CONCRETE\",\n      \"ORANGE_CONCRETE\",\n      \"MAGENTA_CONCRETE\",\n      \"LIGHT_BLUE_CONCRETE\",\n      \"YELLOW_CONCRETE\",\n      \"LIME_CONCRETE\",\n      \"PINK_CONCRETE\",\n      \"GRAY_CONCRETE\",\n      \"LIGHT_GRAY_CONCRETE\",\n      \"CYAN_CONCRETE\",\n      \"PURPLE_CONCRETE\",\n      \"BLUE_CONCRETE\",\n      \"BROWN_CONCRETE\",\n      \"GREEN_CONCRETE\",\n      \"RED_CONCRETE\",\n      \"BLACK_CONCRETE\",\n      \"WHITE_CONCRETE_POWDER\",\n      \"ORANGE_CONCRETE_POWDER\",\n      \"MAGENTA_CONCRETE_POWDER\",\n      \"LIGHT_BLUE_CONCRETE_POWDER\",\n      \"YELLOW_CONCRETE_POWDER\",\n      \"LIME_CONCRETE_POWDER\",\n      \"PINK_CONCRETE_POWDER\",\n      \"GRAY_CONCRETE_POWDER\",\n      \"LIGHT_GRAY_CONCRETE_POWDER\",\n      \"CYAN_CONCRETE_POWDER\",\n      \"PURPLE_CONCRETE_POWDER\",\n      \"BLUE_CONCRETE_POWDER\",\n      \"BROWN_CONCRETE_POWDER\",\n      \"GREEN_CONCRETE_POWDER\",\n      \"RED_CONCRETE_POWDER\",\n      \"BLACK_CONCRETE_POWDER\",\n      \"CONDUIT\",\n      \"POLISHED_GRANITE_STAIRS\",\n      \"SMOOTH_RED_SANDSTONE_STAIRS\",\n      \"MOSSY_STONE_BRICK_STAIRS\",\n      \"POLISHED_DIORITE_STAIRS\",\n      \"MOSSY_COBBLESTONE_STAIRS\",\n      \"STONE_STAIRS\",\n      \"SMOOTH_SANDSTONE_STAIRS\",\n      \"GRANITE_STAIRS\",\n      \"ANDESITE_STAIRS\",\n      \"POLISHED_ANDESITE_STAIRS\",\n      \"DIORITE_STAIRS\",\n      \"COBBLED_DEEPSLATE_STAIRS\",\n      \"POLISHED_DEEPSLATE_STAIRS\",\n      \"DEEPSLATE_BRICK_STAIRS\",\n      \"DEEPSLATE_TILE_STAIRS\",\n      \"POLISHED_GRANITE_SLAB\",\n      \"SMOOTH_RED_SANDSTONE_SLAB\",\n      \"MOSSY_STONE_BRICK_SLAB\",\n      \"POLISHED_DIORITE_SLAB\",\n      \"MOSSY_COBBLESTONE_SLAB\",\n      \"SMOOTH_SANDSTONE_SLAB\",\n      \"GRANITE_SLAB\",\n      \"ANDESITE_SLAB\",\n      \"POLISHED_ANDESITE_SLAB\",\n      \"DIORITE_SLAB\",\n      \"COBBLED_DEEPSLATE_SLAB\",\n      \"POLISHED_DEEPSLATE_SLAB\",\n      \"DEEPSLATE_BRICK_SLAB\",\n      \"DEEPSLATE_TILE_SLAB\",\n      \"SCAFFOLDING\",\n      \"REDSTONE\",\n      \"REDSTONE_TORCH\",\n      \"REDSTONE_BLOCK\",\n      \"REPEATER\",\n      \"COMPARATOR\",\n      \"PISTON\",\n      \"STICKY_PISTON\",\n      \"SLIME_BLOCK\",\n      \"HONEY_BLOCK\",\n      \"OBSERVER\",\n      \"HOPPER\",\n      \"DISPENSER\",\n      \"DROPPER\",\n      \"LECTERN\",\n      \"TARGET\",\n      \"LEVER\",\n      \"DAYLIGHT_DETECTOR\",\n      \"TRIPWIRE_HOOK\",\n      \"TRAPPED_CHEST\",\n      \"TNT\",\n      \"NOTE_BLOCK\",\n      \"STONE_BUTTON\",\n      \"OAK_BUTTON\",\n      \"SPRUCE_BUTTON\",\n      \"BIRCH_BUTTON\",\n      \"JUNGLE_BUTTON\",\n      \"ACACIA_BUTTON\",\n      \"CHERRY_BUTTON\",\n      \"DARK_OAK_BUTTON\",\n      \"MANGROVE_BUTTON\",\n      \"BAMBOO_BUTTON\",\n      \"STONE_PRESSURE_PLATE\",\n      \"LIGHT_WEIGHTED_PRESSURE_PLATE\",\n      \"HEAVY_WEIGHTED_PRESSURE_PLATE\",\n      \"OAK_PRESSURE_PLATE\",\n      \"SPRUCE_PRESSURE_PLATE\",\n      \"BIRCH_PRESSURE_PLATE\",\n      \"JUNGLE_PRESSURE_PLATE\",\n      \"ACACIA_PRESSURE_PLATE\",\n      \"CHERRY_PRESSURE_PLATE\",\n      \"DARK_OAK_PRESSURE_PLATE\",\n      \"MANGROVE_PRESSURE_PLATE\",\n      \"BAMBOO_PRESSURE_PLATE\",\n      \"IRON_DOOR\",\n      \"OAK_DOOR\",\n      \"SPRUCE_DOOR\",\n      \"BIRCH_DOOR\",\n      \"JUNGLE_DOOR\",\n      \"ACACIA_DOOR\",\n      \"CHERRY_DOOR\",\n      \"DARK_OAK_DOOR\",\n      \"MANGROVE_DOOR\",\n      \"BAMBOO_DOOR\",\n      \"COPPER_DOOR\",\n      \"EXPOSED_COPPER_DOOR\",\n      \"WEATHERED_COPPER_DOOR\",\n      \"OXIDIZED_COPPER_DOOR\",\n      \"WAXED_COPPER_DOOR\",\n      \"WAXED_EXPOSED_COPPER_DOOR\",\n      \"WAXED_WEATHERED_COPPER_DOOR\",\n      \"WAXED_OXIDIZED_COPPER_DOOR\",\n      \"IRON_TRAPDOOR\",\n      \"OAK_TRAPDOOR\",\n      \"SPRUCE_TRAPDOOR\",\n      \"BIRCH_TRAPDOOR\",\n      \"JUNGLE_TRAPDOOR\",\n      \"ACACIA_TRAPDOOR\",\n      \"CHERRY_TRAPDOOR\",\n      \"DARK_OAK_TRAPDOOR\",\n      \"MANGROVE_TRAPDOOR\",\n      \"BAMBOO_TRAPDOOR\",\n      \"COPPER_TRAPDOOR\",\n      \"EXPOSED_COPPER_TRAPDOOR\",\n      \"WEATHERED_COPPER_TRAPDOOR\",\n      \"OXIDIZED_COPPER_TRAPDOOR\",\n      \"WAXED_COPPER_TRAPDOOR\",\n      \"WAXED_EXPOSED_COPPER_TRAPDOOR\",\n      \"WAXED_WEATHERED_COPPER_TRAPDOOR\",\n      \"WAXED_OXIDIZED_COPPER_TRAPDOOR\",\n      \"OAK_FENCE_GATE\",\n      \"SPRUCE_FENCE_GATE\",\n      \"BIRCH_FENCE_GATE\",\n      \"JUNGLE_FENCE_GATE\",\n      \"ACACIA_FENCE_GATE\",\n      \"CHERRY_FENCE_GATE\",\n      \"DARK_OAK_FENCE_GATE\",\n      \"MANGROVE_FENCE_GATE\",\n      \"BAMBOO_FENCE_GATE\",\n      \"POWERED_RAIL\",\n      \"DETECTOR_RAIL\",\n      \"RAIL\",\n      \"ACTIVATOR_RAIL\",\n      \"SADDLE\",\n      \"MINECART\",\n      \"CHEST_MINECART\",\n      \"FURNACE_MINECART\",\n      \"TNT_MINECART\",\n      \"HOPPER_MINECART\",\n      \"CARROT_ON_A_STICK\",\n      \"OAK_BOAT\",\n      \"OAK_CHEST_BOAT\",\n      \"SPRUCE_BOAT\",\n      \"SPRUCE_CHEST_BOAT\",\n      \"BIRCH_BOAT\",\n      \"BIRCH_CHEST_BOAT\",\n      \"JUNGLE_BOAT\",\n      \"JUNGLE_CHEST_BOAT\",\n      \"ACACIA_BOAT\",\n      \"ACACIA_CHEST_BOAT\",\n      \"CHERRY_BOAT\",\n      \"CHERRY_CHEST_BOAT\",\n      \"DARK_OAK_BOAT\",\n      \"DARK_OAK_CHEST_BOAT\",\n      \"MANGROVE_BOAT\",\n      \"MANGROVE_CHEST_BOAT\",\n      \"BAMBOO_RAFT\",\n      \"BAMBOO_CHEST_RAFT\",\n      \"TURTLE_HELMET\",\n      \"FLINT_AND_STEEL\",\n      \"APPLE\",\n      \"BOW\",\n      \"ARROW\",\n      \"COAL\",\n      \"CHARCOAL\",\n      \"DIAMOND\",\n      \"EMERALD\",\n      \"LAPIS_LAZULI\",\n      \"AMETHYST_SHARD\",\n      \"RAW_IRON\",\n      \"IRON_INGOT\",\n      \"RAW_COPPER\",\n      \"COPPER_INGOT\",\n      \"RAW_GOLD\",\n      \"GOLD_INGOT\",\n      \"WOODEN_SWORD\",\n      \"WOODEN_SHOVEL\",\n      \"WOODEN_PICKAXE\",\n      \"WOODEN_AXE\",\n      \"WOODEN_HOE\",\n      \"STONE_SWORD\",\n      \"STONE_SHOVEL\",\n      \"STONE_PICKAXE\",\n      \"STONE_AXE\",\n      \"STONE_HOE\",\n      \"GOLDEN_SWORD\",\n      \"GOLDEN_SHOVEL\",\n      \"GOLDEN_PICKAXE\",\n      \"GOLDEN_AXE\",\n      \"GOLDEN_HOE\",\n      \"IRON_SWORD\",\n      \"IRON_SHOVEL\",\n      \"IRON_PICKAXE\",\n      \"IRON_AXE\",\n      \"IRON_HOE\",\n      \"DIAMOND_SWORD\",\n      \"DIAMOND_SHOVEL\",\n      \"DIAMOND_PICKAXE\",\n      \"DIAMOND_AXE\",\n      \"DIAMOND_HOE\",\n      \"STICK\",\n      \"BOWL\",\n      \"STRING\",\n      \"FEATHER\",\n      \"GUNPOWDER\",\n      \"WHEAT_SEEDS\",\n      \"WHEAT\",\n      \"BREAD\",\n      \"LEATHER_HELMET\",\n      \"LEATHER_CHESTPLATE\",\n      \"LEATHER_LEGGINGS\",\n      \"LEATHER_BOOTS\",\n      \"CHAINMAIL_HELMET\",\n      \"CHAINMAIL_CHESTPLATE\",\n      \"CHAINMAIL_LEGGINGS\",\n      \"CHAINMAIL_BOOTS\",\n      \"IRON_HELMET\",\n      \"IRON_CHESTPLATE\",\n      \"IRON_LEGGINGS\",\n      \"IRON_BOOTS\",\n      \"DIAMOND_HELMET\",\n      \"DIAMOND_CHESTPLATE\",\n      \"DIAMOND_LEGGINGS\",\n      \"DIAMOND_BOOTS\",\n      \"GOLDEN_HELMET\",\n      \"GOLDEN_CHESTPLATE\",\n      \"GOLDEN_LEGGINGS\",\n      \"GOLDEN_BOOTS\",\n      \"FLINT\",\n      \"PORKCHOP\",\n      \"COOKED_PORKCHOP\",\n      \"PAINTING\",\n      \"GOLDEN_APPLE\",\n      \"ENCHANTED_GOLDEN_APPLE\",\n      \"OAK_SIGN\",\n      \"SPRUCE_SIGN\",\n      \"BIRCH_SIGN\",\n      \"JUNGLE_SIGN\",\n      \"ACACIA_SIGN\",\n      \"CHERRY_SIGN\",\n      \"DARK_OAK_SIGN\",\n      \"MANGROVE_SIGN\",\n      \"BAMBOO_SIGN\",\n      \"OAK_HANGING_SIGN\",\n      \"SPRUCE_HANGING_SIGN\",\n      \"BIRCH_HANGING_SIGN\",\n      \"JUNGLE_HANGING_SIGN\",\n      \"ACACIA_HANGING_SIGN\",\n      \"CHERRY_HANGING_SIGN\",\n      \"DARK_OAK_HANGING_SIGN\",\n      \"MANGROVE_HANGING_SIGN\",\n      \"BAMBOO_HANGING_SIGN\",\n      \"BUCKET\",\n      \"WATER_BUCKET\",\n      \"LAVA_BUCKET\",\n      \"POWDER_SNOW_BUCKET\",\n      \"SNOWBALL\",\n      \"LEATHER\",\n      \"MILK_BUCKET\",\n      \"PUFFERFISH_BUCKET\",\n      \"SALMON_BUCKET\",\n      \"COD_BUCKET\",\n      \"TROPICAL_FISH_BUCKET\",\n      \"AXOLOTL_BUCKET\",\n      \"TADPOLE_BUCKET\",\n      \"BRICK\",\n      \"CLAY_BALL\",\n      \"DRIED_KELP_BLOCK\",\n      \"PAPER\",\n      \"BOOK\",\n      \"SLIME_BALL\",\n      \"EGG\",\n      \"COMPASS\",\n      \"FISHING_ROD\",\n      \"CLOCK\",\n      \"SPYGLASS\",\n      \"GLOWSTONE_DUST\",\n      \"COD\",\n      \"SALMON\",\n      \"TROPICAL_FISH\",\n      \"PUFFERFISH\",\n      \"COOKED_COD\",\n      \"COOKED_SALMON\",\n      \"INK_SAC\",\n      \"GLOW_INK_SAC\",\n      \"COCOA_BEANS\",\n      \"WHITE_DYE\",\n      \"ORANGE_DYE\",\n      \"MAGENTA_DYE\",\n      \"LIGHT_BLUE_DYE\",\n      \"YELLOW_DYE\",\n      \"LIME_DYE\",\n      \"PINK_DYE\",\n      \"GRAY_DYE\",\n      \"LIGHT_GRAY_DYE\",\n      \"CYAN_DYE\",\n      \"PURPLE_DYE\",\n      \"BLUE_DYE\",\n      \"BROWN_DYE\",\n      \"GREEN_DYE\",\n      \"RED_DYE\",\n      \"BLACK_DYE\",\n      \"BONE_MEAL\",\n      \"BONE\",\n      \"SUGAR\",\n      \"CAKE\",\n      \"WHITE_BED\",\n      \"ORANGE_BED\",\n      \"MAGENTA_BED\",\n      \"LIGHT_BLUE_BED\",\n      \"YELLOW_BED\",\n      \"LIME_BED\",\n      \"PINK_BED\",\n      \"GRAY_BED\",\n      \"LIGHT_GRAY_BED\",\n      \"CYAN_BED\",\n      \"PURPLE_BED\",\n      \"BLUE_BED\",\n      \"BROWN_BED\",\n      \"GREEN_BED\",\n      \"RED_BED\",\n      \"BLACK_BED\",\n      \"COOKIE\",\n      \"SHEARS\",\n      \"MELON_SLICE\",\n      \"DRIED_KELP\",\n      \"PUMPKIN_SEEDS\",\n      \"MELON_SEEDS\",\n      \"BEEF\",\n      \"COOKED_BEEF\",\n      \"CHICKEN\",\n      \"COOKED_CHICKEN\",\n      \"ROTTEN_FLESH\",\n      \"ENDER_PEARL\",\n      \"GOLD_NUGGET\",\n      \"GLASS_BOTTLE\",\n      \"SPIDER_EYE\",\n      \"FERMENTED_SPIDER_EYE\",\n      \"BREWING_STAND\",\n      \"CAULDRON\",\n      \"GLISTERING_MELON_SLICE\",\n      \"EXPERIENCE_BOTTLE\",\n      \"FIRE_CHARGE\",\n      \"WRITABLE_BOOK\",\n      \"ITEM_FRAME\",\n      \"GLOW_ITEM_FRAME\",\n      \"FLOWER_POT\",\n      \"CARROT\",\n      \"POTATO\",\n      \"BAKED_POTATO\",\n      \"POISONOUS_POTATO\",\n      \"GOLDEN_CARROT\",\n      \"PUMPKIN_PIE\",\n      \"FIREWORK_ROCKET\",\n      \"PRISMARINE_SHARD\",\n      \"PRISMARINE_CRYSTALS\",\n      \"RABBIT\",\n      \"COOKED_RABBIT\",\n      \"RABBIT_STEW\",\n      \"RABBIT_FOOT\",\n      \"RABBIT_HIDE\",\n      \"ARMOR_STAND\",\n      \"NAME_TAG\",\n      \"MUTTON\",\n      \"COOKED_MUTTON\",\n      \"BEETROOT\",\n      \"BEETROOT_SEEDS\",\n      \"BEETROOT_SOUP\",\n      \"SPLASH_POTION\",\n      \"SHIELD\",\n      \"IRON_NUGGET\",\n      \"TRIDENT\",\n      \"NAUTILUS_SHELL\",\n      \"HEART_OF_THE_SEA\",\n      \"CROSSBOW\",\n      \"SUSPICIOUS_STEW\",\n      \"LOOM\",\n      \"COMPOSTER\",\n      \"BARREL\",\n      \"SMOKER\",\n      \"BLAST_FURNACE\",\n      \"CARTOGRAPHY_TABLE\",\n      \"FLETCHING_TABLE\",\n      \"GRINDSTONE\",\n      \"SMITHING_TABLE\",\n      \"STONECUTTER\",\n      \"BELL\",\n      \"LANTERN\",\n      \"SWEET_BERRIES\",\n      \"GLOW_BERRIES\",\n      \"CAMPFIRE\",\n      \"HONEYCOMB\",\n      \"BEEHIVE\",\n      \"HONEY_BOTTLE\",\n      \"HONEYCOMB_BLOCK\",\n      \"CRYING_OBSIDIAN\",\n      \"CANDLE\",\n      \"WHITE_CANDLE\",\n      \"ORANGE_CANDLE\",\n      \"MAGENTA_CANDLE\",\n      \"LIGHT_BLUE_CANDLE\",\n      \"YELLOW_CANDLE\",\n      \"LIME_CANDLE\",\n      \"PINK_CANDLE\",\n      \"GRAY_CANDLE\",\n      \"LIGHT_GRAY_CANDLE\",\n      \"CYAN_CANDLE\",\n      \"PURPLE_CANDLE\",\n      \"BLUE_CANDLE\",\n      \"BROWN_CANDLE\",\n      \"GREEN_CANDLE\",\n      \"RED_CANDLE\",\n      \"BLACK_CANDLE\",\n      \"POINTED_DRIPSTONE\",\n      \"BRUSH\",\n      \"COPPER_GRATE\",\n      \"EXPOSED_COPPER_GRATE\",\n      \"WEATHERED_COPPER_GRATE\",\n      \"OXIDIZED_COPPER_GRATE\",\n      \"WAXED_COPPER_GRATE\",\n      \"WAXED_EXPOSED_COPPER_GRATE\",\n      \"WAXED_WEATHERED_COPPER_GRATE\",\n      \"WAXED_OXIDIZED_COPPER_GRATE\",\n      \"WHITE_TERRACOTTA\",\n      \"ORANGE_TERRACOTTA\",\n      \"MAGENTA_TERRACOTTA\",\n      \"LIGHT_BLUE_TERRACOTTA\",\n      \"YELLOW_TERRACOTTA\",\n      \"LIME_TERRACOTTA\",\n      \"PINK_TERRACOTTA\",\n      \"GRAY_TERRACOTTA\",\n      \"LIGHT_GRAY_TERRACOTTA\",\n      \"CYAN_TERRACOTTA\",\n      \"PURPLE_TERRACOTTA\",\n      \"BLUE_TERRACOTTA\",\n      \"BROWN_TERRACOTTA\",\n      \"GREEN_TERRACOTTA\",\n      \"RED_TERRACOTTA\",\n      \"BLACK_TERRACOTTA\",\n      \"NETHERITE_BLOCK\",\n      \"CRIMSON_PLANKS\",\n      \"WARPED_PLANKS\",\n      \"CRIMSON_STEM\",\n      \"WARPED_STEM\",\n      \"STRIPPED_CRIMSON_STEM\",\n      \"STRIPPED_WARPED_STEM\",\n      \"NETHER_GOLD_ORE\",\n      \"NETHER_QUARTZ_ORE\",\n      \"CRIMSON_FUNGUS\",\n      \"WARPED_FUNGUS\",\n      \"CRIMSON_ROOTS\",\n      \"WARPED_ROOTS\",\n      \"NETHER_SPROUTS\",\n      \"CRIMSON_SLAB\",\n      \"WARPED_SLAB\",\n      \"SMOOTH_QUARTZ\",\n      \"NETHERRACK\",\n      \"SOUL_SAND\",\n      \"GLOWSTONE\",\n      \"NETHER_BRICKS\",\n      \"CRACKED_NETHER_BRICKS\",\n      \"CHISELED_NETHER_BRICKS\",\n      \"NETHER_BRICK_FENCE\",\n      \"NETHER_BRICK_STAIRS\",\n      \"CRIMSON_STAIRS\",\n      \"WARPED_STAIRS\",\n      \"NETHER_BRICK_WALL\",\n      \"CHISELED_QUARTZ_BLOCK\",\n      \"QUARTZ_BLOCK\",\n      \"QUARTZ_BRICKS\",\n      \"QUARTZ_PILLAR\",\n      \"QUARTZ_STAIRS\",\n      \"NETHER_WART_BLOCK\",\n      \"WARPED_WART_BLOCK\",\n      \"RED_NETHER_BRICKS\",\n      \"BONE_BLOCK\",\n      \"SMOOTH_QUARTZ_STAIRS\",\n      \"CRIMSON_DOOR\",\n      \"WARPED_DOOR\",\n      \"CRIMSON_TRAPDOOR\",\n      \"WARPED_TRAPDOOR\",\n      \"NETHERITE_INGOT\",\n      \"NETHERITE_SCRAP\",\n      \"QUARTZ\",\n      \"NETHERITE_SWORD\",\n      \"NETHERITE_SHOVEL\",\n      \"NETHERITE_PICKAXE\",\n      \"NETHERITE_AXE\",\n      \"NETHERITE_HOE\",\n      \"NETHERITE_HELMET\",\n      \"NETHERITE_CHESTPLATE\",\n      \"NETHERITE_LEGGINGS\",\n      \"NETHERITE_BOOTS\",\n      \"BLAZE_ROD\",\n      \"GHAST_TEAR\",\n      \"NETHER_WART\",\n      \"BLAZE_POWDER\",\n      \"MAGMA_CREAM\",\n      \"BASALT\",\n      \"SMOOTH_BASALT\",\n      \"POLISHED_BASALT\",\n      \"BLACKSTONE\",\n      \"POLISHED_BLACKSTONE\",\n      \"END_STONE\",\n      \"END_STONE_BRICKS\",\n      \"CHORUS_FRUIT\",\n      \"PURPUR_BLOCK\",\n      \"PURPUR_PILLAR\",\n      \"DRAGON_HEAD\",\n      \"DRAGON_EGG\",\n      \"ELYTRA\",\n      \"REDSTONE_LAMP\",\n      \"LIGHTNING_ROD\"\n    ];\n\n    // Revised item weight function\n    function getItemWeight(item) {\n      const lower = item.toLowerCase();\n      // Special impossible item\n      if (lower === \"petrified_oak_sapling\") return 0.000001;\n      // Legendary rarity: weathered, oxidised, elytra, dragon egg (and their oxidised variants)\n      if (lower.includes(\"weathered\") || lower.includes(\"oxidised\") || lower.includes(\"elytra\") || lower.includes(\"dragon egg\")) {\n        return 0.0001;\n      }\n      // Epic rarity: nether-related items and ender pearls\n      if (lower.includes(\"blaze\") || lower.includes(\"nether\") || lower.includes(\"ender pearl\")) {\n        return 0.001;\n      }\n      // For very valuable ores\n      if (lower.includes(\"diamond\") || lower.includes(\"emerald\") || lower.includes(\"ancient_debris\")) {\n        return 0.005;\n      }\n      // Default common item\n      return 1;\n    }\n\n    /***************************************\n     * 3. CARD GENERATION & PROBABILITY\n     ***************************************/\n    // Generate a 2D card array with weighted item selection (without replacement)\n    function generateCardArray(size) {\n      // Compute probability for the card size selection\n      const totalSizeWeight = sumCardSizeOdds();\n      const sizeProb = cardSizeOdds[size] / totalSizeWeight;\n\n      let picksProbability = 1; // product of each item pick probability\n      let pool = fullItems.slice();\n      let totalPoolWeight = pool.reduce((sum, itm) => sum + getItemWeight(itm), 0);\n      let card = [];\n\n      for (let i = 0; i < size; i++) {\n        card[i] = [];\n        for (let j = 0; j < size; j++) {\n          let r = Math.random() * totalPoolWeight;\n          let chosenIndex = 0;\n          for (let k = 0; k < pool.length; k++) {\n            r -= getItemWeight(pool[k]);\n            if (r < 0) { chosenIndex = k; break; }\n          }\n          let chosenItem = pool[chosenIndex];\n          let weight = getItemWeight(chosenItem);\n          let pickProb = weight / totalPoolWeight;\n          picksProbability *= pickProb;\n          card[i][j] = { item: chosenItem, weight: weight, odds: pickProb };\n          pool.splice(chosenIndex, 1);\n          totalPoolWeight -= weight;\n        }\n      }\n      const finalCardProb = sizeProb * picksProbability;\n      card[0][0]._cardProb = finalCardProb;\n      return card;\n    }\n\n    // Validate card: if any cell is \"petrified_oak_sapling\", it's impossible so reroll the entire card\n    function validateCard(card) {\n      for (let row of card) {\n        for (let cell of row) {\n          if (cell.item.toLowerCase() === \"petrified_oak_sapling\") {\n            return false;\n          }\n        }\n      }\n      return true;\n    }\n\n    async function generateValidatedCard(size) {\n      let card = generateCardArray(size);\n      while (!validateCard(card)) {\n        console.log(\"Impossible card rolled (petrified_oak_sapling detected). Rerolling card...\");\n        card = generateCardArray(size);\n      }\n      return card;\n    }\n\n    /***************************************\n     * 4. BUILDING THE CARD UI\n     ***************************************/\n    function buildCardTable(size) {\n      const table = document.getElementById('bingoCard');\n      table.innerHTML = \"\";\n      for (let i = 0; i < size; i++) {\n        const tr = document.createElement('tr');\n        for (let j = 0; j < size; j++) {\n          const td = document.createElement('td');\n          td.textContent = \"\";\n          tr.appendChild(td);\n        }\n        table.appendChild(tr);\n      }\n    }\n\n    /***************************************\n     * 5. SEQUENTIAL REVEAL ANIMATION\n     ***************************************/\n    // Reveal duration per cell (smaller cards reveal slower, larger cards faster)\n    function getRevealDuration(size) {\n      let fraction = (size - 1) / (10 - 1); // 0 for 1x1, 1 for 10x10\n      let duration = 2000 - 1500 * fraction; // 1x1: 2000ms, 10x10: 500ms\n      if (duration < 400) duration = 400;\n      return duration;\n    }\n\n    // Animate a cell with a slot-machine–style flicker before revealing the final item\n    function revealCell(cell, finalItem, revealTime) {\n      return new Promise((resolve) => {\n        let start = Date.now();\n        let interval = setInterval(() => {\n          if (Date.now() - start >= revealTime) {\n            clearInterval(interval);\n            cell.textContent = finalItem;\n            cell.style.backgroundColor = '#' + Math.floor(Math.random() * 16777215).toString(16);\n            const revealSound = document.getElementById('revealSound');\n            if (revealSound) { revealSound.currentTime = 0; revealSound.play(); }\n            resolve();\n          } else {\n            cell.textContent = fullItems[Math.floor(Math.random() * fullItems.length)];\n          }\n        }, 50);\n      });\n    }\n\n    // Reveal all cells sequentially (one by one) even though card is precomputed\n    async function revealCardSequentially(card) {\n      const table = document.getElementById('bingoCard');\n      const size = card.length;\n      const revealTime = getRevealDuration(size);\n      for (let i = 0; i < size; i++) {\n        for (let j = 0; j < size; j++) {\n          await revealCell(table.rows[i].cells[j], card[i][j].item, revealTime);\n        }\n      }\n    }\n\n    /***************************************\n     * 6. MAIN FUNCTION\n     ***************************************/\n    document.getElementById('startButton').addEventListener('click', async function() {\n      this.disabled = true;\n      document.getElementById('probabilityDisplay').textContent = \"\";\n      document.getElementById('cardSizeDisplay').textContent = \"\";\n      document.getElementById('bingoCard').innerHTML = \"\";\n\n      // 1. Spin the wheel to choose card size\n      const chosenSize = await spinForSize();\n      document.getElementById('cardSizeDisplay').textContent = `Card Size: ${chosenSize}×${chosenSize}`;\n\n      // 2. Generate a validated card (reroll if impossible item appears)\n      const card = await generateValidatedCard(chosenSize);\n\n      // 3. Build the card table\n      buildCardTable(chosenSize);\n\n      // 4. Reveal items sequentially\n      await revealCardSequentially(card);\n\n      // 5. Calculate and display overall card probability\n      const cardProb = card[0][0]._cardProb;  // stored during generation\n      // Display in exponential notation so very small probabilities are visible\n      const probDisplay = (cardProb * 100).toExponential(10) + \"%\";\n      document.getElementById('probabilityDisplay').textContent = `The chance of rolling this exact card is ${probDisplay}`;\n\n      this.disabled = false;\n    });\n  </script>
</body>
</html>
