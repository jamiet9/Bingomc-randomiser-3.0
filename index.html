<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minecraft Bingo Card Randomiser</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background-color: #f0f8ff;
      overflow-x: hidden;
    }
    h1 { margin-bottom: 10px; }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    #cardSizeDisplay { font-size: 18px; margin: 10px 0; }
    #bingoCard {
      margin: 0 auto;
      border-collapse: collapse;
    }
    #bingoCard td {
      border: 2px solid #333;
      width: 80px;
      height: 80px;
      vertical-align: middle;
      font-size: 12px;
      padding: 5px;
      text-align: center;
      background-color: #fff;
      transition: background-color 0.4s;
      position: relative;
    }
    #probabilityDisplay {
      margin-top: 20px;
      font-weight: bold;
      font-size: 16px;
    }
    /* Slot Machine Styles for Card Size */
    #slotMachine {
      display: none;
      margin: 20px auto;
      width: 320px;
      border: 2px solid #333;
      background: #eee;
      padding: 10px;
      text-align: center;
    }
    .reel {
      display: inline-block;
      width: 80px;
      height: 80px;
      margin: 0 5px;
      border: 2px solid #666;
      font-size: 28px;
      line-height: 80px;
      background: #fff;
    }
    /* Card Size Option Controls */
    #cardSizeOption { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>Minecraft Bingo Card Randomiser</h1>
  
  <!-- Card size option controls -->
  <div id="cardSizeOption">
    <p>Randomize card size?</p>
    <input type="radio" name="randomizeSize" id="randomizeYes" value="yes" checked> Yes&nbsp;&nbsp;
    <input type="radio" name="randomizeSize" id="randomizeNo" value="no"> No
    <br><br>
    <select id="manualSizeSelect" style="display: none;">
      <option value="1">1×1</option>
      <option value="2">2×2</option>
      <option value="3">3×3</option>
      <option value="4">4×4</option>
      <option value="5" selected>5×5</option>
      <option value="6">6×6</option>
      <option value="7">7×7</option>
      <option value="8">8×8</option>
      <option value="9">9×9</option>
      <option value="10">10×10</option>
    </select>
  </div>
  
  <button id="startButton">Generate New Card</button>
  <div id="cardSizeDisplay"></div>
  
  <!-- Slot machine for card size randomization (used only if randomization is chosen) -->
  <div id="slotMachine">
    <div class="reel" id="reel1">?</div>
    <div class="reel" id="reel2">?</div>
    <div class="reel" id="reel3">?</div>
  </div>
  
  <table id="bingoCard"></table>
  <div id="probabilityDisplay"></div>
  
  <!-- Optional audio -->
  <audio id="spinSound" src="https://www.myinstants.com/media/sounds/roulette-spin.mp3"></audio>
  <audio id="revealSound" src="https://www.myinstants.com/media/sounds/pling.mp3"></audio>
  
  <script>
    /****************************************
     * Card Size Option Toggle
     ****************************************/
    const randomizeYesRadio = document.getElementById("randomizeYes");
    const randomizeNoRadio = document.getElementById("randomizeNo");
    const manualSizeSelect = document.getElementById("manualSizeSelect");
    
    randomizeYesRadio.addEventListener("change", function() {
      if(this.checked) {
        manualSizeSelect.style.display = "none";
      }
    });
    randomizeNoRadio.addEventListener("change", function() {
      if(this.checked) {
        manualSizeSelect.style.display = "inline-block";
      }
    });
    
    /****************************************
     * 1) CARD SIZE SLOT MACHINE RANDOMIZER
     ****************************************/
    const cardSizeOdds = {
      1: 0.005,
      2: 0.05,
      3: 0.25,
      4: 0.3,
      5: 0.4,
      6: 0.05,
      7: 0.02,
      8: 0.005,
      9: 0.002,
      10: 0.001
    };
    function sumCardSizeOdds() {
      return Object.values(cardSizeOdds).reduce((sum, w) => sum + w, 0);
    }
    function weightedRandomCardSize() {
      let total = sumCardSizeOdds();
      let r = Math.random() * total;
      for (let size in cardSizeOdds) {
        r -= cardSizeOdds[size];
        if (r < 0) return Number(size);
      }
      return 5;
    }
    function animateSlotMachine(finalSize) {
      return new Promise(resolve => {
        const slotMachine = document.getElementById("slotMachine");
        const reel1 = document.getElementById("reel1");
        const reel2 = document.getElementById("reel2");
        const reel3 = document.getElementById("reel3");
        slotMachine.style.display = "block";
        const sizes = Object.keys(cardSizeOdds).map(Number);
        const interval = setInterval(() => {
          reel1.textContent = sizes[Math.floor(Math.random() * sizes.length)] + "×" + sizes[Math.floor(Math.random() * sizes.length)];
          reel2.textContent = sizes[Math.floor(Math.random() * sizes.length)] + "×" + sizes[Math.floor(Math.random() * sizes.length)];
          reel3.textContent = sizes[Math.floor(Math.random() * sizes.length)] + "×" + sizes[Math.floor(Math.random() * sizes.length)];
        }, 100);
        setTimeout(() => {
          clearInterval(interval);
          const display = finalSize + "×" + finalSize;
          reel1.textContent = display;
          reel2.textContent = display;
          reel3.textContent = display;
          const spinSound = document.getElementById("spinSound");
          if (spinSound) { spinSound.currentTime = 0; spinSound.play(); }
          setTimeout(() => {
            slotMachine.style.display = "none";
            resolve(finalSize);
          }, 500);
        }, 2000);
      });
    }
    async function determineCardSize() {
      if(document.getElementById("randomizeYes").checked) {
        const finalSize = weightedRandomCardSize();
        return await animateSlotMachine(finalSize);
      } else {
        return Number(document.getElementById("manualSizeSelect").value);
      }
    }
  
    /****************************************
     * 2) FULL ITEM LIST
     ****************************************/
    // (This sample list includes a representative subset.
    // In your final version, include every item from your list except SUSPICIOUS_SAND, SUSPICIOUS_GRAVEL, and PETRIFIED_OAK_SLAB.)
    const fullItems = [
      "STONE","GRANITE","POLISHED_GRANITE","DIORITE","POLISHED_DIORITE","ANDESITE","POLISHED_ANDESITE",
      "DEEPSLATE","COBBLED_DEEPSLATE","POLISHED_DEEPSLATE","CALCITE","DRIPSTONE_BLOCK","GRASS_BLOCK",
      "DIRT","COARSE_DIRT","PODZOL","ROOTED_DIRT","MUD","COBBLESTONE",
      "OAK_PLANKS","SPRUCE_PLANKS","BIRCH_PLANKS","JUNGLE_PLANKS","ACACIA_PLANKS","CHERRY_PLANKS","DARK_OAK_PLANKS",
      "BAMBOO_PLANKS","BAMBOO_MOSAIC",
      "OAK_SAPLING","SPRUCE_SAPLING","BIRCH_SAPLING","JUNGLE_SAPLING","ACACIA_SAPLING","CHERRY_SAPLING","DARK_OAK_SAPLING",
      "MANGROVE_PROPAGULE",
      "SAND","RED_SAND","GRAVEL",
      "COAL_ORE","IRON_ORE","COPPER_ORE","GOLD_ORE","REDSTONE_ORE","EMERALD_ORE","LAPIS_ORE","DIAMOND_ORE",
      "ANCIENT_DEBRIS",
      "COAL_BLOCK","RAW_IRON_BLOCK","RAW_COPPER_BLOCK","RAW_GOLD_BLOCK","AMETHYST_BLOCK",
      "IRON_BLOCK","COPPER_BLOCK","GOLD_BLOCK","DIAMOND_BLOCK",
      "EXPOSED_COPPER","WEATHERED_COPPER","OXIDIZED_COPPER",
      "CUT_COPPER","EXPOSED_CUT_COPPER","WEATHERED_CUT_COPPER","OXIDIZED_CUT_COPPER",
      "CUT_COPPER_STAIRS","EXPOSED_CUT_COPPER_STAIRS","WEATHERED_CUT_COPPER_STAIRS","OXIDIZED_CUT_COPPER_STAIRS",
      "CUT_COPPER_SLAB","EXPOSED_CUT_COPPER_SLAB","WEATHERED_CUT_COPPER_SLAB","OXIDIZED_CUT_COPPER_SLAB",
      "WAXED_COPPER_BLOCK","WAXED_EXPOSED_COPPER","WAXED_WEATHERED_COPPER","WAXED_OXIDIZED_COPPER",
      "WAXED_CUT_COPPER","WAXED_EXPOSED_CUT_COPPER","WAXED_WEATHERED_CUT_COPPER","WAXED_OXIDIZED_CUT_COPPER",
      "WAXED_CUT_COPPER_STAIRS","WAXED_EXPOSED_CUT_COPPER_STAIRS","WAXED_WEATHERED_CUT_COPPER_STAIRS","WAXED_OXIDIZED_CUT_COPPER_STAIRS",
      "WAXED_CUT_COPPER_SLAB","WAXED_EXPOSED_CUT_COPPER_SLAB","WAXED_WEATHERED_CUT_COPPER_SLAB","WAXED_OXIDIZED_CUT_COPPER_SLAB",
      "SPONGE","WET_SPONGE",
      "CONDUIT",
      "END_STONE","END_STONE_BRICKS","PURPUR_BLOCK","PURPUR_PILLAR",
      "NETHERITE_SWORD","NETHERITE_SHOVEL","NETHERITE_PICKAXE","NETHERITE_AXE","NETHERITE_HOE",
      "NETHERITE_HELMET","NETHERITE_CHESTPLATE","NETHERITE_LEGGINGS","NETHERITE_BOOTS",
      "BLAZE_ROD","ENDER_PEARL"
    ];
  
    /****************************************
     * 2b) REWORKED RARITY SYSTEM
     ****************************************/
    function getItemWeight(itemName) {
      const name = itemName.toUpperCase();
  
      // Make Mangrove_Propagule much rarer:
      if(name === "MANGROVE_PROPAGULE") return 0.0001;
  
      // Ores: extremely rare
      if(name.endsWith("_ORE")) return 0.01;
  
      // Ore blocks & metal blocks: much more common
      if(name.endsWith("_BLOCK") && (name.includes("COAL") || name.includes("IRON") ||
         name.includes("COPPER") || name.includes("GOLD") || name.includes("DIAMOND") ||
         name.includes("EMERALD") || name.includes("LAPIS") || name.includes("AMETHYST")))
         return 2;
  
      // Metal ingots: more common
      if(name.includes("INGOT") && (name.includes("IRON") || name.includes("COPPER") || name.includes("GOLD")))
         return 2;
  
      // Copper variants:
      if(["CUT_COPPER","CUT_COPPER_STAIRS","CUT_COPPER_SLAB","COPPER_GRATE"].includes(name))
         return 0.4;
      // Now any copper item (including those with modifiers) that isn’t in the CUT list:
      if(name.includes("COPPER") && (name.includes("WAXED") || name.includes("EXPOSED") || name.includes("WEATHERED") || name.includes("OXIDIZED")))
         return 0.0001;
  
      // Logs, planks, saplings, leaves, wood items (very common)
      if(name.endsWith("_LOG") || name.endsWith("_WOOD") || name.endsWith("_PLANKS") ||
         name.endsWith("_SAPLING") || name.endsWith("_LEAVES"))
         return 1;
  
      // Basic blocks (common)
      if(["STONE","COBBLESTONE","GRASS_BLOCK","DIRT","COARSE_DIRT","PODZOL","ROOTED_DIRT","MUD"].includes(name))
         return 1;
  
      // Slabs, stairs, walls
      if(name.endsWith("_SLAB") || name.endsWith("_STAIRS") || name.endsWith("_WALL")) {
         if(name.includes("PRISMARINE") || name.includes("SEA_LANTERN"))
            return 0.2;
         return 1;
      }
  
      // Sponge variants: make them even rarer
      if(name === "SPONGE" || name === "WET_SPONGE") return 0.01;
  
      // Brush‐obtained items (pitcher/torchflower and seeds)
      if(name.includes("PITCHER_PLANT") || name.includes("TORCHFLOWER") ||
         name.includes("PITCHER_SEED") || name.includes("TORCHFLOWER_SEED"))
         return 0.01;
  
      // Prismarine and Sea Lantern (if not caught above)
      if(name.includes("PRISMARINE") || name.includes("SEA_LANTERN"))
         return 0.2;
  
      // Conduit – extremely rare
      if(name === "CONDUIT") return 0.001;
  
      // End items – extremely rare
      if(["END_STONE","END_STONE_BRICKS","PURPUR_BLOCK","PURPUR_PILLAR"].includes(name))
         return 0.0001;
  
      // Netherite items – very rare
      if(name.includes("NETHERITE")) return 0.001;
  
      // Advanced items: Blaze items and Ender Pearl
      if(name.includes("BLAZE") || name === "ENDER_PEARL") return 0.001;
      if(name.includes("ANCIENT_DEBRIS")) return 0.005;
  
      // Nether common blocks (basalt, blackstone, netherrack, glowstone)
      if(name.includes("BASALT") || name.includes("BLACKSTONE") ||
         name.includes("NETHERRACK") || name.includes("GLOWSTONE"))
         return 0.02;
  
      // Advanced utility/crafting items (saddle, name tag, enchanting table, anvil)
      if(name.includes("SADDLE") || name.includes("NAME_TAG") ||
         name.includes("ENCHANTING_TABLE") || name.includes("ANVIL"))
         return 0.01;
      // Golden apple, potion, brewing stand
      if(name.includes("GOLDEN_APPLE") || name.includes("POTION") || name.includes("BREWING_STAND"))
         return 0.01;
  
      console.warn("No specific rarity set for:", name, "- assuming common (1)");
      return 1;
    }
  
    /****************************************
     * 3) CARD GENERATION & PROBABILITY
     ****************************************/
    function generateCardArray(size) {
      const totalSizeWeight = sumCardSizeOdds();
      const sizeProb = cardSizeOdds[size] / totalSizeWeight;
      let picksProbability = 1;
      let pool = fullItems.slice();
      let totalPoolWeight = pool.reduce((acc, itm) => acc + getItemWeight(itm), 0);
      let card = [];
      for (let i = 0; i < size; i++) {
        card[i] = [];
        for (let j = 0; j < size; j++) {
          let r = Math.random() * totalPoolWeight;
          let chosenIndex = 0;
          for (let k = 0; k < pool.length; k++) {
            r -= getItemWeight(pool[k]);
            if (r < 0) { chosenIndex = k; break; }
          }
          let chosenItem = pool[chosenIndex];
          let w = getItemWeight(chosenItem);
          let pickProb = w / totalPoolWeight;
          picksProbability *= pickProb;
          card[i][j] = { item: chosenItem, weight: w, odds: pickProb };
          pool.splice(chosenIndex, 1);
          totalPoolWeight -= w;
        }
      }
      const finalCardProb = sizeProb * picksProbability;
      card[0][0]._cardProb = finalCardProb;
      return card;
    }
  
    /****************************************
     * 4) BUILD THE CARD UI
     ****************************************/
    function buildCardTable(size) {
      const table = document.getElementById("bingoCard");
      table.innerHTML = "";
      for (let i = 0; i < size; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j < size; j++) {
          const td = document.createElement("td");
          td.textContent = "";
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
    }
  
    /****************************************
     * 5) SEQUENTIAL REVEAL ANIMATION
     ****************************************/
    function getRevealDuration(size) {
      let fraction = (size - 1) / (10 - 1);
      let duration = 2000 - 1500 * fraction;
      if (duration < 400) duration = 400;
      return duration;
    }
  
    function revealCell(cellElem, finalItem, finalOdds, revealTime) {
      return new Promise(resolve => {
        let startTime = Date.now();
        let interval = setInterval(() => {
          if (Date.now() - startTime >= revealTime) {
            clearInterval(interval);
            cellElem.innerHTML = finalItem + "<br><span style='font-size:10px;'>(" + (finalOdds * 100).toFixed(4) + "%)</span>";
            cellElem.style.backgroundColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
            const revealSound = document.getElementById("revealSound");
            if (revealSound) { revealSound.currentTime = 0; revealSound.play(); }
            resolve();
          } else {
            cellElem.textContent = fullItems[Math.floor(Math.random() * fullItems.length)];
          }
        }, 50);
      });
    }
  
    async function revealCardSequentially(card) {
      const table = document.getElementById("bingoCard");
      const size = card.length;
      const cellDelay = getRevealDuration(size);
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          await revealCell(table.rows[i].cells[j], card[i][j].item, card[i][j].odds, cellDelay);
        }
      }
    }
  
    /****************************************
     * 6) MAIN FUNCTION: PUT IT ALL TOGETHER
     ****************************************/
    document.getElementById("startButton").addEventListener("click", async function() {
      this.disabled = true;
      document.getElementById("probabilityDisplay").textContent = "";
      document.getElementById("cardSizeDisplay").textContent = "";
      document.getElementById("bingoCard").innerHTML = "";
  
      const chosenSize = await determineCardSize();
      document.getElementById("cardSizeDisplay").textContent = `Card Size: ${chosenSize}×${chosenSize}`;
  
      const card = generateCardArray(chosenSize);
      buildCardTable(chosenSize);
      await revealCardSequentially(card);
  
      const cardProb = card[0][0]._cardProb;
      const probDisplay = (cardProb * 100).toExponential(10) + "%";
      document.getElementById("probabilityDisplay").textContent =
        `The chance of rolling this exact card is ${probDisplay}`;
  
      this.disabled = false;
    });
  </script>
</body>
</html>
